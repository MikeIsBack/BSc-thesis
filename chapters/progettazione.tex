\chapter{Progettazione}
\label{cap:progettazione}

\intro{Il seguente capitolo ha la funzione di illustrare l'approccio alla progettazione del sistema commissionato. Viene inoltre descritta l'architettura dell'intero sistema.}

\setlength{\parskip}{3ex}

\section{Approccio MDA}
La filosofia dell'azienda per fronteggiare nuove attività e progetti si basa su un approccio di tipo \textbf{MDA (Model Driven Architecture)}. L'idea alla base di tale approccio risiede nel fatto che il cuore di ogni applicazione si traduce in un modello solido e ben strutturato. 

\setlength{\parskip}{3ex}

\noindent L'approccio MDA è stato utilizzato anche per affrontare la fase di progettazione del sistema commissionato. In particolare la prima attività di progettazione è stata quella di definire i modelli su cui si basa l'intero sistema. Per modello l'azienda intende un qualunque oggetto che deve essere mappato e gestito in un'opportuna tabella di un database relazionale.   

\setlength{\parskip}{3ex}

\noindent I modelli vengono rappresentati dalla seguente stringa:

\setlength{\parskip}{2ex}

\noindent \textbf{NomeModello} (TipoAttributo1 nomeAttributo1, ..., TipoAttributoN nomeAttributoN).

\pagebreak

\noindent In particolare i modelli identificati in base alle richieste del committente sono i seguenti:
\begin{itemize}
\item \textbf{Progetto} (Long idProponente, Long idReferente, String codice, String titolo, String descrizione, String statoAvanzamento, Integer giorni, Integer percentualeAvanzamento, GregorianCalendar dataInizio)

\setlength{\parskip}{3ex}

\noindent \textbf{DESCRIZIONE}: questo modello rappresenta un progetto che viene commissionato all'azienda da parte di un cliente oppure un progetto che viene ideato dall'azienda per raggiungere nuovi clienti.

\setlength{\parskip}{3ex}

\noindent \textbf{ATTRIBUTI}:
\begin{itemize}
\item \textit{idProponente} corrisponde all'identificativo del  proponente, ovvero l'azienda da cui nasce l'idea del progetto (CWBI o altro cliente);
\item \textit{idReferente} corrisponde all'identificativo di un dipendente di CWBI che assume il ruolo di responsabile del progetto;
\item \textit{codice} corrisponde all'identificativo del progetto (es. 2023.70);
\item \textit{titolo} corrisponde al titolo del progetto;
\item \textit{descrizione} corrisponde alla descrizione generale del progetto, composta da obiettivi e funzionalità del sistema;
\item \textit{statoAvanzamento} corrisponde allo stato attuale  del progetto. Lo stato può assumere i seguenti valori: {aperto, chiuso, approvato, rifiutato, sospeso};
\item \textit{giorni} corrisponde ai giorni di sviluppo previsti per portare a termine il progetto;
\item \textit{percentualeAvanzamento} corrisponde alla percentuale di avanzamento delle attività di progetto;
\item \textit{dataInizio} corrisponde alla data di inizio delle attività di progetto.
\end{itemize}

\setlength{\parskip}{6ex}

\item \textbf{CorrelazioneProgettoCliente} (Long idCliente, Long idProgetto)

\setlength{\parskip}{3ex}

\textbf{DESCRIZIONE}: questo modello rappresenta la correlazione che persiste tra un progetto e un certo cliente. Si fa notare che uno stesso progetto può raggiungere più di un cliente e che un cliente può essere coinvolto in più progetti.

\setlength{\parskip}{3ex}

\textbf{ATTRIBUTI}:
\begin{itemize}
\item \textit{idCliente} corrisponde all'identificativo di un cliente;
\item \textit{idProgetto} corrisponde all'identificativo di un progetto esistente.
\end{itemize}

\pagebreak

\item \textbf{Offerta} (Long idCliente, Long idProgetto, String titolo, String descrizione, String stato, GregorianCalendar dataStipula, BigDecimal imponibile1, BigDecimal imponibile2, BigDecimal imponibile3)

\setlength{\parskip}{3ex}

\textbf{DESCRIZIONE}: questo modello rappresenta l'offerta che viene stipulata per un certo cliente in merito ad uno dei progetti a disposizione.

\setlength{\parskip}{3ex}

\textbf{ATTRIBUTI}:
\begin{itemize}
\item \textit{idCliente} corrisponde all'identificativo di un cliente;
\item \textit{idProgetto} corrisponde all'identificativo di un progetto esistente;
\item \textit{titolo} corrisponde al titolo dell'offerta (es. Contratto n.7/2023);
\item \textit{descrizione} corrisponde alla descrizione dell'offerta emessa (note, informazioni utili, ecc.);
\item \textit{stato} corrisponde allo stato attuale dell'offerta. Lo stato può assumere i seguenti valori: in preparazione, in accettazione, accettata;
\item \textit{dataStipula} corrisponde alla data in cui l'offerta è stata emessa;
\item \textit{imponibile1} corrisponde al primo prezzo proposto per firmare l'offerta;
\item \textit{imponibile2} corrisponde al secondo prezzo proposto per firmare l'offerta;
\item \textit{imponibile3} corrisponde al terzo prezzo proposto per firmare l'offerta.
\end{itemize}
\end{itemize}

\setlength{\parskip}{6ex}

\noindent I modelli \textbf{Cliente} e \textbf{Utente}, necessari per realizzare il progetto commissionato, erano già stati definiti per un altro modulo dell'applicazione CW GEST. In particolare questi modelli rappresentano rispettivamente un cliente e un dipendente di CWBI che assume il ruolo di responsabile per un certo progetto. Dato che tali modelli presentano le medesime caratteristiche pensate per il progetto in questione non si è reso necessario alterarli per l'utilizzo.

\setlength{\parskip}{3ex}

\noindent Ai fini del progetto in questione non si rende necessario esporre la struttura del modello Utente; per tale modello infatti l'unico campo utile nell'applicativo risulta essere il nominativo, in modo da conoscere il dipendente responsabile di un certo progetto. Data invece la centralità del modello Cliente nel contesto dell'applicativo commissionato, si riporta comunque una sua caratterizzazione:
\begin{itemize}
\item \textbf{Cliente} (String codice, String descrizione, String partitaIva, String codiceFiscale)

\setlength{\parskip}{3ex}

\textbf{DESCRIZIONE}: questo modello rappresenta un cliente di CWBI.

\setlength{\parskip}{3ex}

\textbf{ATTRIBUTI}:
\begin{itemize}
\item \textit{codice} corrisponde al nominativo del cliente (es. azienda x);
\item \textit{descrizione} corrisponde al nominativo esteso del cliente (es. azienda x SPA);
\item \textit{partitaIva} corrisponde alla partitaIva del cliente;
\item \textit{codiceFiscale} corrisponde al codice fiscale del cliente.
\end{itemize}
\end{itemize} 

\pagebreak

\section{Architettura MVC}
Come citato in precedenza, il framework Apache Struts mette a disposizione un'architettura \textbf{MVC} (Model View Controller) per costruire applicazioni web. \\
L'architettura di Struts non si differenzia particolarmente dalla filosofia della tradizionale MVC: il controller gestisce tutte le operazioni della sistema e ha un riferimento sia al modello sia alla vista. 

\setlength{\parskip}{3ex}

\noindent L'architettura MVC messa a disposizione da Apache Struts può essere rappresentata dal seguente schema:

\begin{figure}[!h]
	\centering
	\includegraphics[width=9cm]{../images/MVC.png}
	\caption{Architettura MVC di Apache Struts}
	\label{fig:MVC}
\end{figure}

\setlength{\parskip}{3ex}

\noindent I tre componenti principali della filosofia MVC corrispondo a:
\begin{itemize}
\item \textbf{FilterDispatcher} (Controller);
\item \textbf{Action} (Model);
\item \textbf{Template} (View).
\end{itemize}

\noindent Come si può notare dalla {\hyperref[fig:MVC]{figura 5.1}}, l'architettura offerta dal framework è caratterizzata da diversi componenti che risulta necessario menzionare per apprendere a fondo il pieno funzionamento dell'architettura MVC di Apache Struts. Questi componenti sono i seguenti: 

\begin{itemize}
\item \textbf{FilterDispatcher}: rappresenta il controller del framework ed è il primo componente ad agire nel ciclo di elaborazione della richiesta. Il controller ispeziona ogni richiesta in arrivo per determinare quale action dovrebbe gestire la richiesta.
\setlength{\parskip}{3ex}

\item \textbf{Action}: rappresenta una funzione dell'applicativo ed è qui che viene definita la logica applicativa del sistema.

\setlength{\parskip}{2ex}

In particolare ogni modello è caratterizzato da n action che gestiscono le n funzionalità che devono essere garantite all'utente per quel modello (es. una action per recuperare il dettaglio di un progetto, una per la creazione/modifica di un progetto, una per la ricerca di un progetto attraverso dei filtri, ecc.).

\setlength{\parskip}{2ex}

Nel dettaglio, ciascuna action ha visibilità delle classi \textit{service}, una per ciascun modello di interesse, necessarie per recuperare i dati del modello dal database. Questo avviene invocando le opportune query SQL costruite mediante il framework Hibernate e esposte dalla classe \textit{service} in modo che queste possano essere utilizzate dalle opportune action per recuperare i dati di interesse dal database.

\setlength{\parskip}{3ex}

\item \textbf{ActionMapper}: viene utilizzata da FilterDispatcher per determinare se la richiesta deve richiamare una action o meno. Quando viene fornito un HttpServletRequest, ActionMapper può restituire null se nessuna action corrisponde alla richiesta  oppure può restituire un ActionMapping che descrive la chiamata.

\setlength{\parskip}{3ex}

\item \textbf{ActionProxy}: se ActionMapper determina che deve essere richiamata una action per tale richiesta, FilterDispatcher delega il controllo ad ActionProxy. L'ActionProxy si consulta con ConfigurationManager, un'interfaccia che descrive la configurazione del framework, e crea una ActionInvocation che si occupa di richiamare l'opportuna action che deve gestire la richiesta entrante.
\setlength{\parskip}{3ex}

\item \textbf{Interceptor}: corrispondono a dei componenti che vengono richiamati prima di eseguire la action e hanno il compito di preparare e inizializzare la action stessa.
\setlength{\parskip}{3ex}

\item \textbf{Result}: corrisponde al risultato costruito e ritornato dalla action. Il risultato viene rappresentato da una pagina JSP.
\setlength{\parskip}{3ex}

\item \textbf{Template}: corrispondono alle pagine di visualizzazione che effettivamente restituiscono la risposta all'utente.
\setlength{\parskip}{3ex}

\end{itemize}

\pagebreak

\noindent Il flusso dell'architettura, che parte da una richiesta lato client, risulta essere il seguente:
\begin{enumerate}
\item la richiesta viene raccolta da ActionMapper;

\item viene chiamato il filtro FilterDispatcher che consulta ActionMapper per determinare se un'azione deve essere richiamata;

\item se ActionMapper trova che un'azione deve essere richiamata, FilterDispatcher delega il controllo ad ActionProxy;

\item ActionProxy legge il file di configurazione (struts.xml). ActionProxy crea un'istanza della classe ActionInvocation e delega il controllo.

\item ActionInvocation richiama gli Interceptor uno per uno (se richiesto) e quindi invoca la action;

\item la action ritorna il risultato, gli Interceptor vengono eseguiti nuovamente in ordine inverso e la risposta viene restituita a FilterDispatcher;

\item il risultato viene ritornato al client.
\end{enumerate}

\pagebreak
